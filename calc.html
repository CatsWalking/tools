<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="./common/images/favicon.svg" sizes="any">
<title>計算ツール</title>
<link rel="stylesheet" href="./common/css/reset.css">
<link rel="stylesheet" href="./common/css/style.css?tedddddstd">
<link rel="stylesheet" href="./common/css/modal.css?teddsddt">
<link rel="stylesheet" href="./common/css/tools.css?tdedsdddtd">
<style>
.contents{
  overflow: scroll;
  height: calc(100vh - 300px);
  margin: 20px auto;
}
td, th{
  padding: 8px 5px;
}
.calc_txt{
  color: #5b84a8;
  font-size: 1rem;
  margin-bottom: 4px;
}
.sign{
  display: inline-block;
  min-width:10px;
  text-align: center;
  color: #374f64;
  font-size: 1.1rem;
  font-weight: 400;
}
.sign.large{
  font-size: 1.4rem;
}
.calc_table {
  max-width: 100%;
  margin: 0 auto;
}   
.input{
  padding: 3px 4px;
  width:90px!important;
}
.input_s{
  width: 56px !important;
}
.input_ss{
  width: 40px !important;
  padding:0;
}
.result{
  display: inline-block;
  font-size:24px;
  text-align: left;
}
.result_height{
  height: 24px; 
  margin-top:8px;
}
.ruby3{
  font-size:18px;
  height:30px;
  padding-top:0;;
  padding-bottom:20px;
} 
.decimal{
  width: 40px !important;
  height: 32px !important;
  text-align: center;
}
.flex{
  display:flex;
}

#tab_subject div{
  min-width: 70px;
}
.prime_number{
  margin-left: 15px;
}
/* 小さい画面 */
@media screen and (max-width: 375px) {
  #tab_subject div{
    min-width: 50px;
    
  }
}
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DP1WEV1PRZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DP1WEV1PRZ');
</script>
<body>
  <div class="container">
    <header></header>
    <main>
      <div class="btnBox" id="tab_subject">
        <div class="status -green" data-subject="1">因数・平方</div>
        <div class="status" data-subject="2">円</div>
        <div class="status" data-subject="3">かけ・わり算</div>
        <div class="status" data-subject="4">割</div>
      </div>
      <div class="contents">

      <!-- 【因数 平方】 -->
      <table class="table2 calc_table" id="calc_1">
        <tbody>
          <tr id="prime">
              <td>
                <div class="calc_txt">素因数分解</div>
                <input type="input" class="input" maxlength="6">
              </td>
              <td><div class="result" style="display: flex"></div></td>
          </tr>
          <!-- 平方数 -->
          <tr id="squre">
            <td>
                <div class="calc_txt">平方数</div>
                <input type="input" class="input" placeholder="11" maxlength="4">
              </td>
              <td><div class="result" style="margin-left: 15px;"></div></td>
          </tr>
          <tr id="squre_root">
            <td>
              <div class="calc_txt">平方根</div>
              <input type="input" class="input" placeholder="144" maxlength="4">
            </td>
            <td><div class="result" style="margin-left: 15px;"></div></td>
          </tr>
        </tbody>
        </table>




        <!-- 【円】 -->
        <table class="table2 calc_table hide" id="calc_2">
          <tbody>
          <!-- 円周の長さ -->
          <tr id="pi">
              <td>
                <div class="calc_txt">円周の長さ</div>
                  (<input type="input" class="same1 input input_s" maxlength="3">
                  <span class="sign"> + </span>
                  <input type="input" class="same1 input input_ss noborder" onFocus="this.blur()" maxlength="3" readonly="readonly" >) 
                  <span class="sign"> × 3.14 × </span> 
                  <input type="input" class="input input_s noclear" maxlength="3" value="360"> <span class="sign"> ℃ =</span> 
                  <div class="result result_height"></div>
              </td>
          </tr>
          <tr id="pi2">
            <td>
              <div class="calc_txt">円の面積</div>
                <input type="input" class="same2 input input_s" axlength="3"> 
                <span class="sign">  × </span>
                <input type="input" class="same2 input input_ss noborder" onFocus="this.blur()" maxlength="3" readonly="readonly" > 
              <span class="sign"> × 3.14 × </span> 
              <input type="input" class="input input_s noclear" maxlength="3" value="360"> <span class="sign"> ℃ =</span> 
              <div class="result result_height"></div>
            </td>
        </tr>
      </tbody>
    </table>
    <!-- 【かけ算・わり算】 -->
    <table class="table2 calc_table hide" id="calc_3">
      <tbody>
        <tr id="multi">
          <td>
            <div class="calc_txt">かけ算</div>
              <input type="input" class="input number">
              <span class="sign large">×</span> 
              <input type="input" class="input number">
              <span class="sign">=</span> 
              <div class="result result_height"></div>
            </td>
          </tr>
          <tr id="division">
            <td>
                <div class="calc_txt">わり算</div>
                <input type="input" class="input number">
                <span class="sign large">÷</span> 
                <input type="input" class="input number">
                <span class="sign">=</span> 
                <div class="result result_height"></div>
            </td>
          </tr>
          <tr id="plus">
            <td>
                <div class="calc_txt">足し算</div>
                <input type="input" class="input number">
                <span class="sign large">+</span> 
                <input type="input" class="input number">
                <span class="sign">=</span> 
                <div class="result result_height"></div>
            </td>
          </tr>
          <tr id="minus">
            <td>
                <div class="calc_txt">引き算</div>
                <input type="input" class="input number">
                <span class="sign large">-</span> 
                <input type="input" class="input number">
                <span class="sign">=</span> 
                <div class="result result_height"></div>
            </td>
          </tr>
        </tbody>
      </table>





       <!-- 【割】 -->
      <table class="table2 calc_table hide" id="calc_4">
        <tbody>
          <!-- ○円の○割引は○円 -->
          <tr id="discount1">
            <td>
                <input type="input" class="input input_s number">
                <span class="sign"> 円の </span>
                <input type="input" class="input input_s number">
                <span class="sign"> 割引きは </span>
                <div class="result"></div> <span class="sign"> 円</span>
            </td>
          </tr>
          <!-- ○円は○円の○割引 -->
          <tr id="discount2">
            <td>
                <input type="input" class="input input_s number">
                <span class="sign"> 円は </span>
                <input type="input" class="input input_s number">
                <span class="sign"> 円の </span>
                <div class="result"></div> <span class="sign"> 割引き</span>
            </td>
          </tr>
            <!-- 150点中90点は6割 -->
            <tr id="rate1">
              <td>
                  <input type="input" class="input input_s number">
                  <span class="sign"> 点中 </span>               
                  <input type="input" class="input input_s number">
                  <span class="sign"> 点は </span>
                  <div class="result"></div> <span class="sign"> 割</span>
              </td>
            </tr>
            <!-- 150点の6割は90点 -->
            <tr id="rate2">
              <td>
                  <input type="input" class="input input_s number">
                  <span class="sign"> 点中 </span>
                  <input type="input" class="input input_s number">
                  <span class="sign"> 割は </span>
                  <div class="result"></div> <span class="sign"> 点</span>
              </td>
            </tr>
        </tbody>
      </table>
    </div>
  </main>


    <!-- footer -->
    <footer>
      <!-- kenkey -->
      <ul class="tenkey_box -row3">
        <li >1</li>
        <li >2</li>
        <li >3</li>
        <li >4</li>
        <li >5</li>
        <li >6</li>
        <li >7</li>
        <li >8</li>
        <li >9</li>
        <li >0</li>
        <li >.</li>
      </ul>
      <div>
        <div class="calc_txt">小数点 第 <input type="input" id="division_decimal" class="input decimal noclear" value="2"> 位まで</div>
      </div>
      <div class="btnBox clear_box" style="text-align: center!important;"></div>
    </footer>



</div><!-- container -->
<script src="./common/js/jquery-3.6.3.min.js"></script>
<script src="./common/js/jquery-ui.js"></script>
<script src="./common/js/common.js?test"></script>
<script src="./common/js/tools.js?test"></script>
<!-- <script src="./common/js/calc.js?test"></script> -->
<script>
/*----------------------------
Roku tools
*/
'use strict';

/** 注 same クラスは１番初めに書く！！ **/
$('[class^=same]').keyup(function(){
  let class_name = $(this).attr('class').split(' ')[0];
  $('.'+class_name).val($('.'+class_name).val());
})

// --------------------
// タブ
$('#tab_subject div').click(function(){
  $('.status').removeClass('-green');
  $(this).addClass('-green');
  let subject = $(this).data('subject');

  $('[id^=calc_').addClass('hide');
  $('#calc_'+subject).removeClass('hide');
})


let i;
let active = 'prime';   // default
let active_input = $('#'+active).find('.input').eq(0);
let active_result;
let input1, input2, input3;
let division_decimal = $('#division_decimal');
let keta=1;
for(i=0; i<division_decimal.val(); i++){
  keta = keta*10;
}

//-------------------
// init
//-------------------
function init(){
    $('.input').removeClass('active');
    active_input.addClass('active');
    active_result = $('#'+active).find('.result');
}
init();
$('#'+active).find('.input').focus();

//-------------------
// focus, tap
//-------------------
$('.calc_table').on('focus click', '.input', function(){
    active = $(this).parent().parent().attr('id');
    active_input = $(this);
    init();
})
// ダブルクリックで上書き
$('.calc_table').on('click', '.input', function(){
    $(this).val('');
})
//-------------------
// キーボード
//-------------------
$('.calc_table .input').keyup(function(){
    calc($(this));
})

$('.calc_table .input').change(function(){
    $(this).val(zenToHan($(this).val()));
})

//-------------------
// テンキー
//-------------------
// let num
$('.tenkey_box li').click(function(){
    let n = $(this).html();
    active_input.val(active_input.val()+n);
    calc(active_input);

    // TODO same の処理
    let tmp_class = active_input.attr('class');
    if(tmp_class!=''){
       let c = tmp_class.split(' ')[0];
       if(c.substr(0,4)=='same'){
        $('.'+c).val($('.'+c).val());
       }
    }
})
//-------------------
// 小数点指定変更されたら
division_decimal.change(function(){
    keta=1;
    for(i=0; i<division_decimal.val(); i++){
        keta = keta*10;
    }
})

/*-----------------------
  計算
-----------------------*/
function calc(active_input){
    active_result.html('')
    let active = active_input.parent().parent().attr('id');

    let inputs = $('#'+active).find('.input');
    if(inputs.eq(0).length){
        input1 = parseFloat(inputs.eq(0).val());
    }
    if(inputs.eq(1).length){
        input2 = inputs.eq(1).val();
    }
    if(inputs.eq(2).length){
        input3 = inputs.eq(2).val();
    }

    //-------------------------
    // 素因数分解、平方数、平方根
    //-------------------------
    let res;
    switch(active){
        case 'prime':
            // 素因数分解
            res = prime(input1); 
            break;
        case 'squre': 
            // 平方数
            res = input1*input1;
            break;
        case 'squre_root':
            // 平方根
            res = Math.round( Math.sqrt(input1) * keta ) / keta;
            break;
        case 'pi':
            // 円周の長さ
            res = Math.round((input1 + input1) * 3.14 * (input3 / 360) * keta) / keta
            break; 
        case 'pi2': 
            // 円の面積
            res = Math.round((input1 * input1) * 3.14 * (input3 / 360) * keta) / keta
            break;        
        case 'multi':   
            // 掛け算
            if(Number.isInteger(input1 * input2)){
                res = input1*input2;
            } else {
                res = Math.round(input1 * input2 * keta) / keta;
            }
            break;
        case 'division':  
            // 割り算
            // 余 = A - 商×B
            res = Math.round(input1 / input2 * keta) / keta;
            let amari = parseInt(input1 % input2);
            if(amari!='' && !isNaN(amari)){
              res = String(res) + "<div style='margin-top:4px;'>"+parseInt(input1/input2)+"<span class='sign'>あまり</span>"+amari+'</div>';
            }
            break;
          case 'plus':  
            // 足し算
            res = parseInt(input1) + parseInt(input2)
            break;
          case 'minus':  
            // 引き算
            res = parseInt(input1) - parseInt(input2)
            break;
        case 'discount1':
            // ○円の○割引は○円
            // （定価 × 割引/10)
            res = input1 - (input1 * input2/10);
            break;
        case 'discount2':
            // ○円は○円の○割引
            // （１－（割引後の価格　÷　元の価格））　×　10
            // =(1-(700/1000))*10
            res = Math.round((1-(input1 / input2))*10*keta)/keta;
            break;
        case 'rate1':  
            // 150点中90点は6割
            res = Math.round(input2 / input1 * 10 * 10) /10
            break;  
        case 'rate2':  
            // 150点の6割は90点
            res = input1 * input2 / 10;
            break;
    }
    // 結果
    active_result.html('')
    if(!(Number.isNaN(res) || res=='Infinity' || res=='-Infinity' || res==0)){
        active_result.html(res)
    }
}

/*-----------------------
  素因数分解
-----------------------*/
function prime(val){
    let primes1 = [];
    let primes2 = [];
    let primes3 = [];
    if(Number(val)){
        for(i=2; i<=50; i++){
            for(let j=0; j<10; j++){
                if(val % i ==0){
                    primes1.push(i);
                    val = val/i;
                } else {
                    break;
                }
            }
        }
        if(val>1){
            primes1.push(val);
        }
        primes1.forEach(function(i, e){
            if(primes2[i]){
                primes2[i]++;
            } else {
                primes2[i] = 1;
            }
        })
        primes2.forEach(function(i, e){
            if(i==1){
                primes3.push("<div class='prime_number'>"+e+"</div>");
            } else {
                primes3.push("<div class='prime_number'>"+e+"</div><div class='ruby'>"+i+"</div>");
            }
        })
        return primes3.join(', ');
    }
    return '';
}

/*-----------------------
  all clear
-----------------------*/
$('#js_clear').click(function(){
    active_input.val('');
    active_result.html('');
})
$('#js_all_clear').click(function(){
    $('.input').not('.noclear').val('');
    $('.result').not('.noclear').html('');
})

</script>
</body>
</html> 
