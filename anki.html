<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="./common/images/favicon.svg" sizes="any">
<title>tools</title>
<link rel="stylesheet" href="./common/css/reset.css">
<link rel="stylesheet" href="./common/css/style.css?fdssds">
<link rel="stylesheet" href="./common/css/modal.css?test">
<link rel="stylesheet" href="./common/css/tools.css?tesd333dtd">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@100;300&display=swap" rel="stylesheet">

<style>
#question,#answer{
  margin: 30px auto;
  width: 90%;
  padding: 10px 20px 20px 10px;
  border-radius: 5px;
  cursor: pointer;
  line-height: 50px;
}
#question{
  height: 240px;
  color: rgb(85, 85, 88);
  background-color: rgb(239, 240, 241);
}
#answer{
  height: 30px;
  text-align:center;
  color: rgb(169, 102, 103);
}
.btn{
  min-width: 90px!important;
}
#info, #info div,span{
  font-size: 0.9rem;
}
@media screen and (min-width: 960px) {
  .caution{
    width: 600px;
  }
}
</style>
</head>
<body>
  <div class="container">
    <header class="header"></header>
    <main>
      <div class="btnBox" id="tab_subject">
        <div class="status -green" data-subject="4">社会</div>
        <div class="status" data-subject="3">理科</div>
      </div>
      <div id="click_area" style="height:100%">
        <!-- 質問 -->
        <div id="question"></div>
        <!-- 解答 -->
        <div style="height:60px;margin-bottom: 20px;" id="answer_box">
          <div id="answer" class="hide"></div>
        </div>
        <!-- 情報 -->
        <div class="hide" id="id"></div>
      </div>
     
      <!-- footer -->
      <div class="footer">
        <div id="info">
          <div><span id="no"></span> / <span id="total"></span></div>
          <span id="cnt"></span>回目 
          <span id="status"></span>
        </div>
        <div class="btnBox" id="result">
          <div class="btn -yellow" data-status="3">NG</div>
          <div class="btn -blue" data-status="1">OK</div>
          <div class="btn -green" data-status="2">REPEAT</div>
        </div>
        <div class="btnBox" style="margin-top: 20px;">
          <div class="btn -gray inactive" id="js_back" >戻る</div>
          <div class="btn -blue" id="js_next" >次へ</div>
        </div>
        <div class="btnBox" id="tab_order_type" style="margin-top: 30px;">
            <div class="status -green" data-order_type="1">途中から</div>
            <div class="status" data-order_type="2">初めから</div>
            <div class="status" data-order_type="3">後ろから</div>
            <div class="status" data-order_type="4">ランダム</div>
        </div>
      </div>
    </main>
</div>


<div id="add_form" class="hide">
  <input type="text" id="new_subject" value="4">
  <textarea id="new_question"></textarea>
  <textarea id="new_answer"></textarea>
  <div class="btn" id="js_save">保存</div>
</div>
<!-- container -->
<script src="./common/js/jquery-3.6.3.min.js"></script>
<script src="./common/js/jquery-ui.js"></script>
<script src="./common/js/common.js"></script>
<script src="./common/js/load.js?tesat"></script>
<script src="./common/js/tools.js?tesat"></script>
<script>
  'use strict'
  $(function(){
      let no=0;
      let questions;
      let Q = $('#question');
      let A = $('#answer');
      let id = $('#id');
      let url = 'https://mami.tools/tools/';
      let subject = 4;
      let order_type = 1;
      let status_arr = {0:'未', 1:'OK',2:'REPEAT',3:'NG'}

      //--------------------------
      // 設問を取得する
      //--------------------------
      getAllQuestions();

      function getAllQuestions(){
        $.get(url+'?action=getAllQuestions&subject='+subject+'&order_type='+order_type, function(data){
          questions = data
          // 設問セット
          set();
        })
      }
      //--------------------------
      // 設問セット
      function set(){
        Q.html(questions[no]['question'])
        A.html(questions[no]['answer'])
        id.html(questions[no]['id'])
        $('#status').html(status_arr[questions[no]['status']])
        $('#cnt').html(parseInt(questions[no]['cnt']??0)+1)
        A.addClass('hide');
        $('#no').html(no+1);
        $('#total').html(questions.length);
        // btn
        if(no==0){
          $('#js_back').addClass('inactive')
        } else {
          $('#js_back').removeClass('inactive')
        }
        if(no==questions.length-1){
          $('#js_next').addClass('inactive')
        } else {
          $('#js_next').removeClass('inactive')
        }
      }
      //--------------------------
      // 回答
      $('#result .btn').click(function(){
        // 解答が非表示だったら、まず開いてから
        if(A.hasClass('hide')){
          A.removeClass('hide');
          return;
        }
        $.get(url+'?action=answer&status='+$(this).data('status')+'&id='+id.html(), function(){
          no++;
          set();
        })
      })
      //--------------------------
      // 科目変更
      $('#tab_subject div').click(function(){
        subject = $(this).data('subject');
        // 設問再取得
        getAllQuestions();
        $(this).parent().find('div').removeClass('-green');
        $(this).addClass('-green');
      })
      //--------------------------
      // 並び変更
       $('#tab_order_type div').click(function(){
        order_type = $(this).data('order_type');
        // 設問再取得
        getAllQuestions();
        $(this).parent().find('div').removeClass('-green');
        $(this).addClass('-green');
      })
      //--------------------------
      // 保存  
      $('#js_save').click(function(){
        let data = {subject: $('#new_subject').val(), answer: $('#new_answer').val(), question: $('#new_question').val() }
          $.ajax({
            url: url+"?action=saveAnki",
            type: 'post',
            data: data,
            success: function( result ){
              console.log(result);
            },
            error: function( err, text, message ){
              console.log(err, text, message);
            }
          });
      })
      //--------------------------
      // 解答 表示・非表示
      $('#click_area').click(function(){
        if($(this).hasClass('btn')){
          return;
        } 
        if(A.hasClass('hide')){
        A.removeClass('hide');
        } else {
          A.addClass('hide');
        }
      })

      // 戻る
      $('#js_back').click(function(){
        if($(this).hasClass('inactive')){
          return;
        }
        no--;
        set();
      })
      // 次へ
      $('#js_next').click(function(){
        if($(this).hasClass('inactive')){
          return;
        }
        no++;
        set();
      })
  })
</script>
</body>
</html> 