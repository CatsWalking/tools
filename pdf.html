<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <div class="container">  
      <div class="btn" id="test" >test</div>
      <p>Paste your image here…</p>
      <!-- <div width="100%">       -->
        <!-- <img id="container"/> -->
        <canvas width="600px" height="500px%" id="mycanvas" style="background-color: red;"></canvas>

</div><!-- container -->
<script src="./common/js/jquery-3.6.3.min.js"></script>
<script src="./common/js/jquery-ui.js"></script>
<script src="./common/js/common.js"></script>
<script src="./common/js/tools.js?tesat"></script>
<!-- <script src="./common/js/calc.js?tesat"></script> -->

<script>
'use strict';
$(function(){
//   document.onpaste = function(pasteEvent) {
//     //最初のアイテムを検討します(複数のアイテムに簡単に拡張できます)
//     var item = pasteEvent.clipboardData.items[0];
//     let container = $('#container');
 
//     if (item.type.indexOf("image") === 0)    {
//         var blob = item.getAsFile();
//         var reader = new FileReader();
//         reader.onload = function(event) {
//           container.attr('src', event.target.result);
//             // document.getElementById("container").src = event.target.result;
//         };
 
//         reader.readAsDataURL(blob);
//         console.log(item);
//         container.css('width', '100%');
//         // itme.style.width=100;
//     }
// }


 // canvas準備
 const board = document.querySelector("#mycanvas");  //getElementById()等でも可。オブジェクトが取れれば良い。
  const ctx = board.getContext("2d");

  // 画像読み込み
  const chara = new Image();
  chara.src = "./common/images/sample.jpg";  // 画像のURLを指定
  chara.onload = () => {
    ctx.drawImage(chara, 0, 0);
  }
document.onpaste = function(pasteEvent) {
    imagePaste( pasteEvent );
    return false;
  }
  function imagePaste( event ){
  var blobimg = null;
  var items = ( event.clipboardData || event.originalEvent.clipboardData ).items;
  for( var i = 0; i < items.length; i ++ ){
    if( items[i].type.indexOf( "image" ) == 0 ){
      blobimg = items[i].getAsFile();
    }
  }
  if( blobimg != null ){
    var bloburl = URL.createObjectURL( blobimg );

    var canvas = document.getElementById( "mycanvas" );
    var ctx = canvas.getContext( '2d' );

    var img = new Image();
    img.src = bloburl;
    img.onload = function(){
      var sw = img.naturalWidth;
      var sh = img.naturalHeight;
      var dw = canvas.width;
      var dh = canvas.height;
      ctx.drawImage( img, 0, 0, sw, sh, 0, 0, dw, dh );
    };
  }
}

$('#test').click(function(){
  test();
})


function test() {
    var canvas = document.getElementsByTagName("canvas")[0];
    // const canvas = document.querySelector("#mycanvas");  //getElementById()等でも可。オブジェクトが取れれば良い。

    var context = canvas.getContext("2d");
    var imageData = context.getImageData(0, 0, canvas.width, canvas.height);

    let r, g, b;
    for(var i = 0; i < (imageData.width*imageData.height); i++) {
      r = imageData.data[i*4];
      g = imageData.data[i*4+1];
      b = imageData.data[i*4+2];
      

      // if((r==255 && g==132 && b==70)||
      //   (r==254 && g==149 && b==110)||
      //   (r==253 && g==165 && b==126)){
      //     imageData.data[i*4] = 255;
      //     imageData.data[i*4+1] = 255;
      //     imageData.data[i*4+2] = 255;
      //     imageData.data[i*4+3] = 0.5;
      //     console.log(r, g, b);

      // }
/*
if((r>=235 && r<=255)||
        (g>=130 && g<=200)||
        (b>=50 && b<=225)){
*/
      if((r>=253 && r<=255)||
        (g>=100 && g<=255)||
        (b>=50 && b<=250)){
          imageData.data[i*4] = 255;
          imageData.data[i*4+1] = 255;
          imageData.data[i*4+2] = 255;
          imageData.data[i*4+3] = 255;
          console.log(333, r, g, b);

      }
      // console.log(222, r, g, b);
      // imageData.data[i*4] = 255;
      // imageData.data[i*4+1] = 255;
      // imageData.data[i*4+2] = 255;
      // imageData.data[i*4+3] = 0.5;

      // console.log(123,imageData.data[i*4], imageData.data[i*4+1], imageData.data[i*4+2]);
      //   if((imageData.data[i*4] == r) &&
      //      (imageData.data[i*4+1] == g) &&
      //      (imageData.data[i*4+2] == b)) {
      //       // imageData.data[i*4+3] = 0;
      //       console.log(456,imageData.data[i*4], imageData.data[i*4+1], imageData.data[i*4+2]);
      //       imageData.data[i*4] = 255;
      //       imageData.data[i*4+1] = 255;
      //       imageData.data[i*4+2] = 255;
      //       imageData.data[i*4+3] = 0.5;


      //   }
        // if((imageData.data[i*4] >=230 && imageData.data[i*4]<=255) &&
        //    (imageData.data[i*4+1] >=253 && imageData.data[i*4+1] == g) &&
        //    (imageData.data[i*4+2] >=253 && imageData.data[i*4+2] == b)) {
        //     imageData.data[i*4] = 255;
        //     imageData.data[i*4+1] = 255;
        //     imageData.data[i*4+2] = 255;
        //     imageData.data[i*4+3] = 0.5;


        // }
    }
    context.putImageData(imageData, 0, 0);
    return;
}
})
</script>
</body>
</html> 
