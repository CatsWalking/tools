<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="./common/images/favicon.svg" sizes="any">
<title>Roku.tools|因数分解</title>
<link rel="stylesheet" href="./common/css/reset.css">
<link rel="stylesheet" href="./common/css/style.css?aa">
<link rel="stylesheet" href="./common/css/modal.css?aa">
<link rel="stylesheet" href="./common/css/tools.css?aa">
<style>
.range {
  background-color: #6eb6e4;
  min-height: initial;
  height: 0px;
  border: 0;
  border-radius: 6px;
  outline: none;
}
.range::-webkit-slider-thumb{
    -webkit-appearance:none;
    background:#fff;
    height:15px;
    width:15px;
    border:2px solid #6eb6e4;
    border-radius:50%;
}
.outer > div, .outer > img{
  text-align:center;
  display: table-cell;
  vertical-align:middle;
}
#question{
  background:#DCE7F2;
  font-size:4rem;
  height: 100px;
}
#question {
  
  /* line-height: 100px;
  text-align: center;
  display: table-cell; */
  /* width: 98%; */
  /* letter-spacing: 1rem; */
}

/* PC */
@media screen and (min-width: 960px) {
  #question {
    height: 120px;
  }
}
#answer{
  color:rgb(57, 102, 179);
  font-size: 3rem;
}

.tenkey_box li{
  height: 50px;
  font-size: 1.8rem; 
}
.btn.-s{
  padding:2px;
}
.btn_box.btn{
  min-width: 100px!important;
}
@media screen and (min-width: 960px) {
  .btn_box .btn {
      width: 100px;
  }
  #howto{
    padding-top: 30px;
  }
}
#cnt{
  margin-left: 20px;
  font-size:1rem;
}
#cnt span{
  font-size:1rem;
  color:#585151;
}
.status{
    min-width: 40px;
    height: 24px;
}
#howto{
    line-height: 2.4rem;
}
#howto td{
    padding:0;
    text-align:left;
    font-size: 0.9rem;
}
.tab_label{
    display: inline-block; width:55px;font-size: 0.7rem;
}
.conf div{
    background:none;
    border:1px solid rgba(0, 172, 239, 0.3);
    cursor: auto;
}
.box.-l{
    width:50px;
    height:50px;
}
#js_ok {
  height: 100px;
  line-height: 100px;
}
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DP1WEV1PRZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('conf', 'G-DP1WEV1PRZ');
</script>
<body>
<div class="container">
  <header></header>
  <main>
    <div id="start_message">タップしてスタート</div>
    <!-- HOWTO -->
    <div id="howto">
      <p style="font-size: 1.6rem;margin:20px;">素因数分解ゲーム</p> 
      <p>因数分解できたら<img src="./common/images/icon/go.png" class="icon -ss">をタップ</p> 
      <!-- レベル -->
      <p>レベルと回数を選んでスタート！</p> 
      <table style="width:360px;margin: 20px auto;padding:0;">
        <tr><td width="50">レベル</td>
            <td class="tab_level">
                <div class="status">1</div>
                <div class="status -green">2</div>
                <div class="status">3</div>
                <div class="status">4</div>
                <div class="status">5</div>
            </td>
        </tr>
        <tr><td>回数</td>
            <td class="tab_times">
                <div class="status">3</div>
                <div class="status -green">5</div>
                <div class="status">10</div>
                <div class="status">15</div>
                <div class="status">20</div>
            </td>
        </tr>
        <tr><td><img src="./common/images/icon/beginner.png" class="icon -sss"></td>
            <td class="radioarea txtLeft">
                <label class="-checked"><input type="radio" name="display_help" value="1" checked>ヒント表示する</label>
                <label><input type="radio" name="display_help" value="0">ヒント表示しない</label>
            </td>
        </tr>
       </table>
       <!-- スタート -->
       <div class="btn js_start">スタート</div>
      <hr class="mt20">
      <div><img src="./common/images/icon/pause.png" class="icon -ss"> 一時停止 </div>
      <div><img src="./common/images/icon/close.png" class="icon -ss"> 終了</div>
      <ul style="line-height: 1.6rem;width:150px;text-align:left;margin: 20px auto;">
        <li>level 1: 5 〜 100</li>
        <li>level 2: 101 〜 500</li>
        <li>level 3: 501 〜 1000</li>
        <li>level 4: 1001 〜 2000</li>
        <li>level 5: 2001 〜 3000</li>
      </ul>
    </div>
    <!-- OK -->
    <div class="outer">
      <div id="ok_sign">
        <img src="./common/images/animals/kuma02.png" width="200">
        <p>OK</p>
      </div>
    </div>
    <!-- ヘッダ -->
    <div class="header_box">
      <div id="timer" class="timer">0.00</div>
      <div id="cnt"><span id="current_cnt">1</span> / <span id="all_cnt">5</span></div>
      <div id="help"></div>
      <div><img src="./common/images/icon/beginner.png" class="icon -ss" id="display_help"></div>
      <div><img src="./common/images/icon/pause.png" class="icon -ss" id="js_pause" style="margin-right:4px;"></div>
      <div><img src="./common/images/icon/close.png" class="icon -ss js_quit"></div>
    </div>
    <!-- レベル -->
    <div class="btn_box conf">
      <span class="tab_label">レベル</span>
      <div class="status level_1">1</div>
      <div class="status level_2">2</div>
      <div class="status level_3">3</div>
      <div class="status level_4">4</div>
      <div class="status level_5">5</div>
  </div>
  <div class="btn_box conf">
      <span class="tab_label">回数</span>
      <div class="status times_3">3</div>
      <div class="status times_5">5</div>
      <div class="status times_10">10</div>
      <div class="status times_15">15</div>
      <div class="status times_20">20</div>
  </div>

    <!-- 設問 -->
    <div class="outer"><div id="question"></div></div>
    <div class="outer"><div id="answer"></div></div>
    <div class="outer"><div id="prime" class="ruby3"></div></div>
  </main>

  <!-- footer -->
  <footer>
    <!-- kenkey -->
    <table width="100%">
      <tr>
        <td rowspan="3">
          <ul class="tenkey_box -column3">
            <li>2</li>
            <li>3</li>
            <li>5</li>
            <li>7</li>
            <li>11</li>
            <li>13</li>
            <li>17</li>
            <li>19</li>
            <li>23</li>
          </ul>
        </td>
        <td style="text-align:center;width: 60px !important; height:50px;">
          <div id="js_clear" class="box -l">×</div>
        </td>
      </tr>
      <tr>
        <td rowspan="2" style="text-align:center;">
          <div id="js_ok">GO</div>
        </td>
      </tr>
    </table>
  </footer>
</div><!-- container -->
<script src="./common/js/jquery-3.6.3.min.js"></script>
<script src="./common/js/jquery-ui.js"></script>
<script src="./common/js/common.js?test"></script>
<script src="./common/js/modal.js?test"></script>
<script src="./common/js/tools.js?test"></script>
<script>
$(function(){
/*----------------------------
Roku tools
*/
'use strict';
//https://k3su.xyz/
const prime_choices = [2, 3, 5, 7, 11, 13, 17, 19, 23];
// let min, max;
const levels = {1:{'min':50,'max':100}, 
          2:{'min':101,'max':500},
          3:{'min':501,'max':1000},
          4:{'min':1001,'max':2000},
          5:{'min':2001,'max':3000}};
let conf = {level:2, times:5};

//-------------------------
// RokuToolを継承
//-------------------------
class myRokuTool extends RokuTool{
  primes = [];    // 素数を生成しておく

  constructor() {
    super(conf)
  }

//-------------------------
// 設問をセット
//------------------------- 
setQuestion = ()=>{
  $('#question').html( this.questions[this.current]);
  $('#prime').html(this.primes[this.current].join(','));
}

//-------------------------
// 指定回数分の設問を作成して配列に入れておく
//-------------------------
generateQuestions = ()=>{
  // 指定の数分、乱数を生成（かぶらないように）
  for(let times_i=0; times_i<conf.times; times_i++){
    let tmp_primes;
    let r;
    // 素数だったり、被ってたしてい再生成するため最大30回ループ
    for(let i=0; i<30; i++){  
      // 乱数取得
      r = rand(levels[this.conf.level]['min'], levels[this.conf.level]['max']);
      
      // 素因数分解する
      tmp_primes = this.prime(r);
      let flg = true;

      if(tmp_primes.length == 1){
        //-------------------------
        // rand自体が素数なのでやり直し
        flg = false;
      } else {
        //-------------------------
        // 選択肢に含まれない素数がないかチェック
        tmp_primes.forEach(function(pri){
          if(!in_array(pri, prime_choices)){
            flg = false
          }
        })
      }
      if(flg){
        // 条件に収まる数値がきたら終了！
        break;
      }
    }
    this.primes[times_i] = tmp_primes;
    this.questions[times_i] = r;
  }
}

//-------------------------
// 指定回数分の設問を作成して配列に入れておく
//-------------------------
tenkey = (e)=>{
    let n = $(e.currentTarget).html();
    this.answer_arr.push(parseInt(n));
    $('#answer').html(this.answer_arr.join(', '));
    // ヘルプセット
    let help = this.questions[this.current];
    for(let i=0; i<this.answer_arr.length; i++){
      help = help / this.answer_arr[i];
    }
    $('#help').removeClass('txtRed');
    if(help==1){
      help = '';
    } else if(!Number.isInteger(help)){
      $('#help').addClass('txtRed');
      help =help.toFixed(2);
    }
    $('#help').html(help);

    // ヘルプ表示時、間違った数字をタップしたらガクブル
    if(!in_array(parseInt(n), this.primes[this.current])){
      Gakuburu($('#question'), 300);
      this.miss++;
    }
}
// 判定
judge = ()=>{
  return (this.answer_arr.length>0 && 
    JSON.stringify(this.primes[this.current].sort()) === JSON.stringify(this.answer_arr.sort()));
}
// クリア
clear = ()=>{
  this.answer_arr.pop();
  this.setHelp();
  $('#answer').html(this.answer_arr.join(', '));
}
//-------------------
// set help
//-------------------
setHelp = ()=>{
  let help = this.questions[this.current];
  for(let i=0; i<this.answer_arr.length; i++){
    help = help / this.answer_arr[i];
  }
  $('#help').removeClass('txtRed');
  if(help==1){
    help = '';
  } else if(!Number.isInteger(help) && help!=''){
    $('#help').addClass('txtRed');
    help = help.toFixed(2);
  }
  $('#help').html(help);
}
/*-----------------------
  素因数分解
-----------------------*/
prime = (val) => {
  let tmp_primes = [];
  if(Number(val)){
      for(let i=2; i<=50; i++){
          for(let j=0; j<10; j++){
              if(val % i ==0){
                tmp_primes.push(i);
                  val = val/i;
              } else {
                  break;
              }
          }
      }
      if(val>1){
        tmp_primes.push(parseInt(val));
      }
  }
  return tmp_primes;
}

}

//-------------------------
// RokuTool インスタンス
//-------------------------
myRokuTool = new myRokuTool(conf);
// timer
myRokuTool.timer = new Timer($('#timer'));
myRokuTool.useKeyboard = false;



// オブジェクトを中央に
jQuery.prototype.offsetCenter=function() {
  var left=this.offset().left;
  var top=this.offset().top;
  var width=this.width();
  var height=this.height();
  left=left+(width/2);
  top=top+(height/2);
  return {
    top,
    left
  }
}



})
</script>
</body>
</html> 
