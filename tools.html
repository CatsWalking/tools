<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="./common/images/favicon.svg" sizes="any">
<title>tools</title>
<link rel="stylesheet" href="./common/css/reset.css">
<link rel="stylesheet" href="./common/css/style.css?testd">
<link rel="stylesheet" href="./common/css/modal.css?test">
<link rel="stylesheet" href="./common/css/tools.css?testd">
<style>
#calc {
  max-width: 100%;
  margin: 0 auto;
}    
#calc td:nth-child(1){
  width:60%;
}
#calc td:nth-child(2){
  width:40%;
}
.ruby3{
    font-size:18px;
    height:30px;
    padding-top:0;;
    padding-bottom:20px;
} 

.number{
  width: 80px!important;
}
.sign{
  width: 20px;
  line-height: 50px;
  font-size:2rem;
  margin: 0 10px;
}
.option{
  display:flex;
  line-height: 30px;
}
.decimal{
  width: 40px !important;
  height: 32px !important;
  text-align: center;
}
.flex{
  display:flex;
}
</style>
</head>
<body>
  <div class="container">
    <header class="header"></header>
    <main>
    <table class="table2" id="calc">
      <tbody>
        <tr id="multi">
          <td>
            <div class="flex">
              <input type="input" class="input number" data-type="multi"> 
              <div class="sign">×</div> 
              <input type="input" class="input number" data-type="multi"> 
              <div class="sign">=</div> 
            </div>
            </td>
            <td><span class="result"></span></td>
          </tr>
          <tr id="division">
            <td>
              <div class="flex">
                <input type="input" class="input number" data-type="division"> 
                <div class="sign">÷</div> 
                <input type="input" class="input number" data-type="division"> 
                <div class="sign">=</div> 
              </div>
            </td>
            <td><span class="result"></span></td>
          </tr>

          <!-- 150点中90点は6割 -->
          <tr id="rate1">
            <td>
              <div class="flex">
                <input type="input" class="input number" data-type="rate1"> 
                <div style="width:50px"> 点中 </div>               
                <input type="input" class="input number" data-type="rate1"> 
                <div style="width:50px"> 点は </div>
              </div>
            </td>
            <td><span class="result"></span> 割</td>
          </tr>
          <!-- 150点の6割は90点 -->
          <tr id="rate2">
            <td>
              <div class="flex">
                <input type="input" class="input number" data-type="rate2"> 
                <div style="width:50px"> 点中 </div>
                <input type="input" class="input number" data-type="rate2"> 
                <div style="width:50px"> 割は </div>
              </div>
            </td>
            <td><span class="result"></span> 点</td>
          </tr>
      </tbody>
    </table>

    <!-- kenkey -->
    <ul class="tenkey_box -row3">
      <li >1</li>
      <li >2</li>
      <li >3</li>
      <li >4</li>
      <li >5</li>
      <li >6</li>
      <li >7</li>
      <li >8</li>
      <li >9</li>
      <li >0</li>
      <li >.</li>
    </ul>

    <div class="option">小数点 第 <input type="input" id="division_decimal" class="input decimal" value="2"> 位まで</div>
    <div class="btnBox" style="text-align: center!important;">
      <div class="btn" id="js_clear">クリア</div>
      <div class="btn -red" id="js_all_clear">全てクリア</div>
    </div>

</div><!-- main -->
</div><!-- container -->
<script src="./common/js/jquery-3.6.3.min.js"></script>
<script src="./common/js/jquery-ui.js"></script>
<script src="./common/js/common.js"></script>
<script src="./common/js/tools.js?tesat"></script>
<!-- <script src="./common/js/calc.js?tesat"></script> -->

<script>
'use strict';
$(function(){
  let i;
  let active = 'multi';
  let target_index = 0;
  let active_input = $('#'+active).find('.input').eq(target_index);
  let active_result;
  let input1,input2;
  let division_decimal = $('#division_decimal');
  let keta=1;
  for(i=0; i<division_decimal.val(); i++){
    keta = keta*10;
  }

  /*-----------------------
    init
  -----------------------*/
  function init(){
    active_input = $('#'+active).find('.input').eq(target_index);
    active_result = $('#'+active).find('.result');
    $('.input').removeClass('active');
    active_input.addClass('active');
  }
  init();
  active_input.focus();

/*-----------------------
  テンキー
-----------------------*/
let num
$('.tenkey_box li').click(function(){
  let n = $(this).html();
  active_input.val(active_input.val()+n);
  calc();
})


$('#calc').on('click, focusin', '.input', function(){
  $(this).val('');
    active = $(this).data('type');
    target_index = $(this).index()-1;
    if(target_index<0){
      target_index = 0;
    }
    init();
  })
$('#calc').on('keyup', '.input', function(){
  calc();
})

//-------------------
// 小数点指定変更されたら
division_decimal.change(function(){
  keta=1;
  for(i=0; i<division_decimal.val(); i++){
    keta = keta*10;
  }
})

function calc(){
  input1 = $('#'+active).find('.input').eq(0).val();
  input2 = $('#'+active).find('.input').eq(1).val();

  switch(active){
    //-------------------
    // 掛け算
    case 'multi':   
    if(Number.isInteger(input1*input2)){
      active_result.html(input1*input2);
    } else {
      active_result.html(Math.round(input1*input2*keta)/keta);
    }

      break;
    //-------------------
    // 割り算
    case 'division':  
      if(!isFinite(input1/input2)){
        active_result.html('');
      } else{
        active_result.html(Math.round(input1/input2*keta)/keta);
      }
    break;
    //-------------------
    // 150点中90点は6割
    case 'rate1':  
      active_result.html(Math.round(input2/input1*10*2)/2);
      break;
    //-------------------
    // 150点の6割は90点
    case 'rate2':  
      active_result.html(input1*input2/10);
    break;
      
  }
}


/*-----------------------
  all clear
-----------------------*/
$('#js_clear').click(function(){
  active_input.val('');
  active_result.html('');
})
$('#js_all_clear').click(function(){
  $('.number').val('');
  $('.result').html('');
})
})
</script>
</body>
</html> 
