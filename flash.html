<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="./common/images/favicon.svg" sizes="any">
<title>tools</title>
<link rel="stylesheet" href="./common/css/reset.css">
<link rel="stylesheet" href="./common/css/style.css?te5std">
<link rel="stylesheet" href="./common/css/modal.css?te5st">
<link rel="stylesheet" href="./common/css/tools.css?t5estd">
<style>
body {
    user-select: none;
}
#tab_edu a{
    padding:5px 0 ;
}
.tab_label{
    display: inline-block; width:55px;font-size: 0.8rem;
}
.tenkey_box{
    background:#ecf9f0;
}
#question{
  height: 100px;
  line-height:100px;
  background:#ecf9f0;
  border-radius: 5px;
  text-align:center;
  display: table-cell;
  font-size: 4rem;
  letter-spacing: 1rem;
}
/* PC */
@media screen and (min-width: 960px) {
  #question {
    height: 120px;
  }
}
/* 小さい画面 */
@media screen and (max-width: 375px) {
  #question {
    height: 70px;
    font-size: 3rem;
    margin:24px auto;
  }
  #tab_level{
    margin: 0 auto ;
    margin-bottom: 10px;
  }
  #tab_level div{
    height: 30px;
    font-size: 1.2rem;
  }
}
#answer{
  color:rgb(20, 179, 55);
  font-size: 4rem;
}
.tenkey_box li{
  height: 50px;
  font-size: 1.8rem; 
}
#ok_sign{
  position:absolute;
  width: 100%;
  height: 100%;
  margin: 0 auto;
  font-size: 3rem;
  color:rgb(227, 49, 49);
  background:#fff;
  display: none;
  z-index:9999;
  padding-top: 50px;
  text-align: center;
}
.status{
    min-width: 40px;
}
#howto{
    line-height: 2.4rem;
}
#howto td{
    padding:0;
    text-align:left;
    font-size: 0.8rem;
}
.conf div{
    background:none;
    border:1px solid rgba(0, 172, 239, 0.3);
    cursor: auto;
}
#js_ok {
  height: 180px;
  line-height: 180px;
}
.box.-l{
    width:48px;
    height:48px;
}
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DP1WEV1PRZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('conf', 'G-DP1WEV1PRZ');
</script>
<body>
  <div class="container">
    <header></header>
    <main>
        <div id="start_message">タップしてスタート</div>
    <!-- HOWTO -->
    <div id="howto">
        <p style="font-size: 3rem;margin:20px;">flash</p> 
        <!-- レベル -->
        <p>レベル、スピード、回数 を選んでスタート！</p> 
        <table style="width:350px;margin: 20px auto;padding:0;">
            <tr><td width="60">レベル</td>
                <td class="tab_level">
                    <div class="status">1</div>
                    <div class="status -green">2</div>
                    <div class="status">3</div>
                    <div class="status">4</div>
                    <div class="status">5</div>
                </td>
            </tr>
            <tr><td width="60">スピード</td>
                <td class="tab_speed">
                    <div class="status">1</div>
                    <div class="status -green">2</div>
                    <div class="status">3</div>
                    <div class="status">4</div>
                    <div class="status">5</div>
                </td>
            </tr>
            <tr><td width="60">回数</td>
                <td class="tab_times">
                    <div class="status">3</div>
                    <div class="status -green">5</div>
                    <div class="status">10</div>
                    <div class="status">15</div>
                    <div class="status">20</div>
                </td>
            </tr>
            <tr><td width="60"><img src="./common/images/icon/beginner.png" class="icon -sss"></td>
                <td class="radioarea txtS txtLeft">
                    <label class="-checked"><input type="radio" name="display_help" value="1" checked>ヒント表示する</label>
                    <label><input type="radio" name="display_help" value="0">ヒント表示しない</label>
                </td>
            </tr>
        </table>
        <!-- スタート -->
        <div class="btn js_start">スタート</div>
        <hr>
        <div class="txtS mtb20" style="line-height:1.6rem;">※ 検定・大会問題等の<br>問題出力方法・作問規定 とは異なります</div>
        <div>
            <ul style="line-height: 1.6rem;width:150px;text-align:left;margin: 10px auto;">
                <li>level 1: 5 〜 20</li>
                <li>level 2: 21 〜 50</li>
                <li>level 3: 51 〜 100</li>
                <li>level 4: 101 〜 200</li>
                <li>level 5: 201 〜 1000</li>
            </ul>
            <ul style="line-height: 1.6rem;width:150px;text-align:left;margin: 10px auto;">
                <li>speed 1: 1500sec </li>
                <li>speed 2: 1300sec </li>
                <li>speed 3: 1000sec </li>
                <li>speed 4: 800sec </li>
                <li>speed 5: 500sec </li>
        </div>
      </div>
       <!-- OK -->
        <div class="outer">
        <div id="ok_sign">
          <img src="./common/images/animals/kuma04.png" width="200">
          <p>OK</p>
        </div>
      </div>
<!-- ヘッダ -->
<div class="header_box">
    <div id="timer" class="timer">0.00</div>
    <div id="cnt"><span id="current_cnt">1</span> / <span id="all_cnt">5</span></div>
    <div><img src="./common/images/icon/beginner.png" class="icon -ss" id="display_help"></div>
    <div><img src="./common/images/icon/close.png" class="icon -ss js_quit"></div>
  </div>
  <div class="btn_box conf">
        <span class="tab_label">レベル</span>
        <div class="status level_1">1</div>
        <div class="status level_2">2</div>
        <div class="status level_3">3</div>
        <div class="status level_4">4</div>
        <div class="status level_5">5</div>
    </div>
    <div class="btn_box conf">
        <span class="tab_label">スピード</span>
        <div class="status speed_1">1</div>
        <div class="status speed_2">2</div>
        <div class="status speed_3">3</div>
        <div class="status speed_4">4</div>
        <div class="status speed_5">5</div>
    </div>
    <div class="btn_box conf">
        <span class="tab_label">回数</span>
        <div class="status times_3">3</div>
        <div class="status times_5">5</div>
        <div class="status times_10">10</div>
        <div class="status times_15">15</div>
        <div class="status times_20">20</div>
    </div>
    <div class="outer mt20"><div id="question"></div></div>
    <div class="outer" style="width:98%;text-align: center;"><div id="help"></div></div>
    <div class="outer" style="width:98%;text-align: center;"><div id="answer"></div></div>
    </main>
    <!-- footer -->
  <footer>
    <!-- kenkey -->
    <table width="100%">
        <tr>
          <td rowspan="3">
            <ul class="tenkey_box -column3">
                <li>1</li>
                <li>2</li>
                <li>3</li>
                <li>4</li>
                <li>5</li>
                <li>6</li>
                <li>7</li>
                <li>8</li>
                <li>9</li>
                <li>0</li>
            </ul>
          </td>
          <td style="text-align:center;width: 60px !important; height:50px;">
            <div id="js_clear" class="box -l">×</div>
          </td>
        </tr>
        <tr>
          <td rowspan="2" style="text-align:center;">
            <div id="js_ok">GO</div>
          </td>
        </tr>
      </table>
  </footer>
</div><!-- container -->
<script src="./common/js/jquery-3.6.3.min.js"></script>
<script src="./common/js/jquery-ui.js"></script>
<script src="./common/js/common.js?tesssast"></script>
<script src="./common/js/modal.js?tesst"></script>
<script src="./common/js/tools.js?tesst"></script>
<script>
// https://keisanginou.jimdofree.com/%E3%83%95%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E6%9A%97%E7%AE%97/
'use strict'
$(function(){
let question = $('#question');
let rnd_arr = [];
let flg = false;
const levels = {1:{'min':5,'max':20}, 
            2:{'min':21,'max':50},
            3:{'min':51,'max':100},
            4:{'min':101,'max':200},
            5:{'min':201,'max':1000}};
const speeds = {1:1300,2:1000,3:800,4:500,5:300}
let conf = {level:2, speed:2, times:5};
let current_cnt = 0;
let miss = 0;
let answer = '';    // 解答
let correct = 0;    // 正解
let numbers = [];   // 指定回数分設問を入れておく
let history = [];   // 履歴を入れておく
// timer
let timer = new Timer($('#timer'));
RokuTool = new RokuTool(conf);

let counter = 0;
let num = 0;

function init(){
    // 指定回数分設問を作成
    generateNumber();
    miss = 0;
    current_cnt=1;
    $('#current_cnt').html(current_cnt);
    $('#howto').css('display', 'none');
    $('#timer').html('0.00');
    start();
}
function start(){
    $('#question').html('');
    $('#answer').html('');
    $('#help').html('');
    correct = 0;
    answer = '';
}
//-------------------------
// 設定 タブ
//-------------------------
setConf(conf);

RokuTool.clickTab('level');
RokuTool.clickTab('speed');
RokuTool.clickTab('times');


//-------------------------
// howtoスタート click
$('.js_start').click(function(){
    $('.level_'+RokuTool.conf['level']).addClass('-green');
    $('.speed_'+RokuTool.conf['speed']).addClass('-green');
    $('.times_'+RokuTool.conf['times']).addClass('-green');
    $('#all_cnt').html(RokuTool.conf.times);
    $('#howto').css('display', 'none');
})
//-------------------------
// タップしてスタート
$('#start_message').click(function(){
    init();
    // タイマースタート
    timer.runTimer();
    setQuestion();
    $(this).css('display', 'none');
})
//-------------------------
// 設問セット
//-------------------------
function setQuestion(){
    start();
    $('#current_cnt').html(current_cnt);
    $('#ok_sign').removeClass('fadeUp');
    $('#ok_sign').css('display', 'none');
    if(timer.isRunning){
        counter = 0;
        let num;
        let q_time_id = setInterval(function () {
        if (counter < RokuTool.conf.times) {
            num = numbers[current_cnt-1][counter];
            question.html(num);
            counter++;
            correct += num;
        } else {
            clearInterval(q_time_id);
            // 2秒後に指揮を表示
            window.setTimeout(function(){
              $('#help').html(numbers[current_cnt-1].join(' + '));
            }, 2000)
            
        }
        }, speeds[RokuTool.conf.speed]);
    }
}
$('#help').click(function(){
    if(correct!='' && $('#help').html()!='' && isActive($('#display_help')) && $(this).html().indexOf('=')==-1){
        $('#help').html( $('#help').html()+' = ' + correct)
    }
})
// 終了
$(document).on('click', '.js_quit', function(){
  openConfirm('quit?', function(){
    location.href = getUrl()+"?"+getConfParam(conf);
  })
})

// リトライ
$(document).on('click', '.js_retry', function(){
    $('#howto').css('display', 'none');
    $('#start_message').css('display', 'block');
    init();
})
// ヘルプtoggle
$('#display_help').click(function(){
  $('#help').toggle();
  toggleIcon($(this), ICON_DIR+'beginner.png');
})
//-------------------
// テンキー
//-------------------
$('.tenkey_box li').click(function(){
    if(!timer.isRunning){
      return;
    }
    answer = answer+String($(this).html());
    $('#answer').html(answer);
})
/*-----------------------
 clear
-----------------------*/
$('#js_clear').click(function(){
    if(!timer.isRunning){
        return;
    }
    answer = answer.substr(0,answer.length-1);
    $('#answer').html(answer);
})
/*-----------------------
 判定！！OK
-----------------------*/
$('#js_ok').click(function(){
    if(!timer.isRunning){
        return;
    }
    if(parseInt(answer)==parseInt(correct)){
        if(parseInt(current_cnt)==parseInt(RokuTool.conf.times)){
            // 指定回数完了！！
            end();
            return;
        }
        // カウントアップ
        current_cnt += 1;
        start();
        // OKくまさんを表示して、0.7秒後に次の問題へ
        $('#ok_sign').addClass('fadeUp');
        $('#ok_sign').css('display', 'block');
        setTimeout(() => {
            setQuestion();
        }, "700");
    } else {
        Gakuburu($('#question'), 300);
        miss++;
    }
})
/**---------------------------------------------
 * 指定回数分の設問を作成して配列に入れておく
 */
function generateNumber() {
    let rnd;
    // 指定の数分乱数を生成（かぶらないように）
    for(let i=0; i<RokuTool.conf.times; i++){
        rnd_arr = [];
        while (Object.keys(rnd_arr).length < RokuTool.conf.times) {
            rnd = rand(levels[RokuTool.conf.level].min, levels[RokuTool.conf.level].max);
            // 存在しなかったら追加(level1&count=10は、数がかぶりすぎてスタックする)
            if (rnd_arr.indexOf(rnd) == -1 || (RokuTool.conf.level == 0 && RokuTool.conf.times > 5)) {
                rnd_arr.unshift(rnd);
            }
        }
        numbers[i] = rnd_arr;
    }
}

/*-----------------------
 end
-----------------------*/
function end(){
  $('#howto').css('display', 'block');
  let score_time = ((Date.now() - timer.startTime) / 1000).toFixed(2);
  let str = "<p>Finish!!</p>"
    + "<p>レベル： " + RokuTool.conf.level + "</p>"
    + "<p>タイム： <span style='font-size:2.2rem;'>" + score_time + "</span></p>"
    + "<p>間違えた回数： " + miss +"回</p>"
    +"<div class='btn_box'><div class='btn js_retry'>もう一回</div>"
    +"<div class='btn js_quit'>終了</div></div>"
    +"<div class='txtSS mt20'>レベルやスピードを変更するときは「終了」</div>";
  // 履歴を保存
  history.push((history.length+1)+'. '+'level'+RokuTool.conf.level+" <b style='font-size:1.5rem;'> " + score_time + " </b> (miss " + miss + ")");
  if(history.length>1){
    str = str+'<hr>'+history.join('<br>');
  }
  $('#howto').html(str);
  timer.stopTimer();
  $('#message').css('display', 'block');
}

// ヒントtoggle
$('[name=display_help]').click(function(){
    if($('[name=display_help]:checked').val()==1){
        $('#display_help').attr('src', ICON_DIR+'beginner.png');
        $('#help').css('display', 'block');
    } else {
        $('#display_help').attr('src', ICON_DIR+'beginner_off.png');
        $('#help').css('display', 'none');
    }
})
})
</script>
</body>
</html> 