<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="./common/images/favicon.svg" sizes="any">
<title>tools</title>
<link rel="stylesheet" href="./common/css/reset.css">
<link rel="stylesheet" href="./common/css/style.css?te5std">
<link rel="stylesheet" href="./common/css/modal.css?te5st">
<link rel="stylesheet" href="./common/css/tools.css?t5estd">
<style>
body {
    user-select: none;
}
#tab_edu a{
    padding:5px 0 ;
}
.tab_label{
    display: inline-block; width:55px;font-size: 0.7rem;
}
#question{
  height: 100px;
  line-height:100px;
  background:#ecf4f9;
  border-radius: 5px;
  text-align:center;
  display: table-cell;
  font-size: 4rem;
  letter-spacing: 1rem;
}
/* PC */
@media screen and (min-width: 960px) {
  #question {
    height: 120px;
  }
}
/* 小さい画面 */
@media screen and (max-width: 375px) {
  #question {
    height: 70px;
    font-size: 3rem;
    margin:24px auto;
  }
  #tab_level{
    margin: 0 auto ;
    margin-bottom: 10px;
  }
  #tab_level div{
    height: 30px;
    font-size: 1.2rem;
  }
}
#answer{
  font-size: 3rem;
}
#message{
  position:absolute;
  top:30%;
  width: 98%;
  height: 120px;
  line-height: 120px;
  text-align: center;color:rgb(224, 130, 130);background-color: rgb(250, 215, 227);
  font-size:1.6rem;
}
.tenkey_box li{
  height: 50px;
  font-size: 1.8rem; 
}
#ok_sign{
  position:absolute;
  width: 100%;
  height: 100%;
  margin: 0 auto;
  font-size: 3rem;
  color:rgb(227, 49, 49);
  background:#fff;
  display: none;
  z-index:9999;
  padding-top: 50px;
  text-align: center;
}
.status{
    min-width: 40px;
}
#howto{
    line-height: 2.4rem;
}
</style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DP1WEV1PRZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DP1WEV1PRZ');
</script>
<body>
  <div class="container">
    <!-- <header></header> -->
    <main>
        <div id="message">タップしてスタート</div>
    <!-- HOWTO -->
    <div id="howto">
        <div style="margin-top:20px;"><img src="./common/images/animals/kuma03.png" class="icon -l"></div>
        <p style="font-size: 3rem;">flash</p> 
        <!-- レベル -->
        <p>レベル、スピード、回数 を選んでスタート！</p> 
        <div class="btn_box tab_level" style="margin:0">
            <div style="display: inline-block; width:55px;font-size: 0.7rem;">レベル</div>
            <div class="status" data-id="1">1</div>
            <div class="status -green" data-id="2">2</div>
            <div class="status" data-id="3">3</div>
            <div class="status" data-id="4">4</div>
            <div class="status" data-id="5">5</div>
        </div>
        <div class="btn_box tab_speed" style="margin:0">
            <div style="display: inline-block; width:55px;font-size: 0.7rem;">スピード</div>
            <div class="status" data-id="1">1</div>
            <div class="status -green" data-id="2">2</div>
            <div class="status" data-id="3">3</div>
            <div class="status" data-id="4">4</div>
            <div class="status" data-id="5">5</div>
        </div>
        <div class="btn_box tab_times" style="margin:0">
            <div style="display: inline-block; width:55px;font-size: 0.7rem;">回数</div>
            <div class="status" data-id="3">3</div>
            <div class="status -green" data-id="5">5</div>
            <div class="status" data-id="10">10</div>
            <div class="status" data-id="15">15</div>
            <div class="status" data-id="20">20</div>
        </div>
        <div class="btn js_start mtb20">スタート</div>
        <hr>
        <div><img src="./common/images/icon/beginner.png" class="icon -ss"> ヒントの表示・非表示</div>
        <div><img src="./common/images/icon/pause.png" class="icon -ss"> 一時停止 </div>
        <div><img src="./common/images/icon/close.png" class="icon -ss"> 終了</div>
        <div class="txtS">※ 検定・大会問題等の問題出力方法・作問規定 とは異なります</div>
        <div>

            <ul style="line-height: 1.6rem;width:150px;text-align:left;margin: 0 auto;">
                <p>level1: 50〜100 </p>
                <p>level2: 101〜500</p>
                <p>level3: 501〜1000</p>
                <p>level4: 1001〜2000</p>
                <p>level5: 2001〜3000</li>
            </ul>
        </div>
      </div>
       <!-- OK -->
    <div class="outer">
        <div id="ok_sign">
          <img src="./common/images/animals/kuma_02.png" width="200">
          <p>OK</p>
        </div>
      </div>
<!-- ヘッダ -->
<div class="header_box">
    <div id="timer" class="timer">0.00</div>
    <div id="cnt"><span id="current_cnt">1</span> / <span id="all_cnt">5</span></div>
    <div id="help"></div>
    <div><img src="./common/images/icon/beginner.png" class="icon -ss" id="display_help"></div>
    <div><img src="./common/images/icon/pause.png" class="icon -ss" id="js_pause" style="margin-right:4px;"></div>
    <div><img src="./common/images/icon/close.png" class="icon -ss js_quit"></div>
  </div>

  <div class="btn_box">
        <div class="tab_label">レベル</div>
        <div class="status level_1">1</div>
        <div class="status level_2">2</div>
        <div class="status level_3">3</div>
        <div class="status level_4">4</div>
        <div class="status level_5">5</div>
    </div>
    <div class="btn_box">
        <div class="tab_label">スピード</div>
        <div class="status speed_1">1</div>
        <div class="status speed_2">2</div>
        <div class="status speed_3">3</div>
        <div class="status speed_4">4</div>
        <div class="status speed_5">5</div>
    </div>
    <div class="btn_box">
        <div class="tab_label">回数</div>
        <div class="status times_3">3</div>
        <div class="status times_5">5</div>
        <div class="status times_10">10</div>
        <div class="status times_15">15</div>
        <div class="status times_20">20</div>
    </div>

    <div class="outer mtb30"><div id="question"></div></div>
    <div class="outer" style="width:98%;text-align: center;"><div id="formula"></div></div>
    <div class="outer" style="width:98%;text-align: center;"><div id="answer"></div></div>

    </main>
    <!-- footer -->
  <footer>
    <!-- kenkey -->
    <table width="100%">
        <tr>
          <td rowspan="3">
            <ul class="tenkey_box -column3">
                <li>1</li>
                <li>2</li>
                <li>3</li>
                <li>4</li>
                <li>5</li>
                <li>6</li>
                <li>7</li>
                <li>8</li>
                <li>9</li>
                <li>0</li>
            </ul>
          </td>
          <td style="text-align:center;width: 60px !important; height:50px;">
            <div id="js_clear" class="box -l">×</div>
          </td>
        </tr>
        <tr>
          <td rowspan="2" style="text-align:center;">
            <div id="js_ok">GO</div>
          </td>
        </tr>
      </table>
  </footer>
</div><!-- container -->
<script src="./common/js/jquery-3.6.3.min.js"></script>
<script src="./common/js/jquery-ui.js"></script>
<script src="./common/js/common.js"></script>
<script src="./common/js/modal.js"></script>
<script src="./common/js/tools.js?te5sat"></script>
<script>
// https://keisanginou.jimdofree.com/%E3%83%95%E3%83%A9%E3%83%83%E3%82%B7%E3%83%A5%E6%9A%97%E7%AE%97/
'use strict'
$(function(){
let question = $('#question');
let rnd_arr = [];
let flg = false;
const levels = {1:{'min':50,'max':100}, 
            2:{'min':101,'max':500},
            3:{'min':501,'max':1000},
            4:{'min':1001,'max':2000},
            5:{'min':2001,'max':3000}};
const speeds = {1:1300,2:1000,3:800,4:500,5:300}
let config = {level:2, speed:2, times:5};
let current_cnt = 0;
let miss = 0;
let answer = '';    // 解答
let correct = 0;    // 正解
let numbers = [];   // 指定回数分設問を入れておく
let history = [];   // 履歴を入れておく
// timer
let timer = new Timer($('#timer'));

let counter = 0;
let num = 0;

function init(){
    $('#question').html('');
    $('#answer').html('');
    $('#formula').html('');
    correct = 0;
    answer = '';
}

//-------------------------
// 設定 タブ
//-------------------------
clickTab('level');
clickTab('speed');
clickTab('times');
function clickTab(tab){
    $('.tab_'+tab+' div').click(function(){
        config[tab] = $(this).data('id');
        $(this).parent().find('.status').removeClass('-green');
        $(this).addClass('-green');
        $('.'+tab+'_'+config[tab]).addClass('-green');
   })
}
//-------------------------
// howtoスタート click
$('.js_start').click(function(){
    $('.level_'+config['level']).addClass('-green');
    $('.speed_'+config['speed']).addClass('-green');
    $('.times_'+config['times']).addClass('-green');

    $('#all_cnt').html(config.times);
    $('#howto').css('display', 'none');
})
//-------------------------
// タップしてスタート
$('#message').click(function(){
    // 指定回数分設問を作成
    generateNumber();
    $(this).css('display', 'none');
    init();
    miss = 0;
    current_cnt=1;
    $('#current_cnt').html(current_cnt);
    // タイマースタート
    timer.runTimer();
    setQuestion();
})

//-------------------------
// 設問セット
//-------------------------
function setQuestion(){
    // answer = '';
    init();
    $('#current_cnt').html(current_cnt);

    $('#ok_sign').removeClass('fadeUp');
    $('#ok_sign').css('display', 'none');
    if(timer.isRunning){
        counter = 0;
        let num;
        let timer_id = setInterval(function () {
        if (counter < config.times) {
            num = numbers[current_cnt-1][counter];
            question.html(num);
            counter++;
            correct += num;
        } else {
            clearInterval(timer_id);
            if(isHelpActive()){
                $('#formula').html(numbers[current_cnt-1].join(' + '));
            }
        }
        }, speeds[config.speed]);
    }
}
$('#formula').click(function(){
    if(correct!='' && $('#formula').html()!='' && isHelpActive()){
        $('#formula').html( $('#formula').html()+' = ' + correct)
    }
})
// ヘルプがアクティブかどうか
function isHelpActive(){
    console.log($('#display_help').attr('src'));
    return $('#display_help').attr('src').indexOf('_off')== -1;
}
//-------------------------
// 一時停止
//-------------------------
$('#js_pause').click(function(){
  if($('#timer').html()=='0.00' || question.html()==''){
    return;
  }
  if(timer.isRunning){
    timer.pauseTimer(); // pause
  } else {
    timer.restartTimer();   // restart
  }
  toggleImg($(this), ICON_DIR+'pause.png');
})
// 終了
$(document).on('click', '.js_quit', function(){
  openConfirm('quit?', function(){
    location.href=location.href;
  })
})
// リトライ
$(document).on('click', '.js_retry', function(){
  $('#howto').css('display', 'none');
})
// ヘルプtoggle
$('#display_help').click(function(){
  $('#help').toggle();
  toggleImg($(this), ICON_DIR+'beginner.png');
})
//-------------------
// テンキー
//-------------------
$('.tenkey_box li').click(function(){
    if(!timer.isRunning){
      return;
    }
    answer = answer+String($(this).html());
    $('#answer').html(answer);
})
/*-----------------------
 clear
-----------------------*/
$('#js_clear').click(function(){
    if(!timer.isRunning){
        return;
    }
    answer = answer.substr(0,answer.length-1);
    $('#answer').html(answer);
})
/*-----------------------
 判定！！OK
-----------------------*/
$('#js_ok').click(function(){
    if(!timer.isRunning){
        return;
    }
    if(parseInt(answer)==parseInt(correct)){
        if(parseInt(current_cnt)==parseInt(config.times)){
            // 指定回数完了！！
            end();
            return;
        }
        // カウントアップ
        current_cnt += 1;
        init();
        // OKくまさんを表示して、0.7秒後に次の問題へ
        $('#ok_sign').addClass('fadeUp');
        $('#ok_sign').css('display', 'block');
        setTimeout(() => {
            setQuestion();
        }, "700");
    } else {
        Gakuburu($('#question'), 300);
        miss++;
    }
})


/**---------------------------------------------
 * 指定回数分の設問を作成して配列に入れておく
 */
function generateNumber() {
    let rnd;
    // 指定の数分乱数を生成（かぶらないように）
    for(let i=0; i<config.times; i++){
        rnd_arr = [];
        while (Object.keys(rnd_arr).length < config.times) {
            rnd = rand(levels[config.level].min, levels[config.level].max);
            // 存在しなかったら追加(level1&count=10は、数がかぶりすぎてスタックする)
            if (rnd_arr.indexOf(rnd) == -1 || (config.level == 0 && config.times > 5)) {
                rnd_arr.unshift(rnd);
            }
        }
        numbers[i] = rnd_arr;
    }
}

/*-----------------------
 end
-----------------------*/
function end(){
  $('#howto').css('display', 'block');
  let score_time = ((Date.now() - timer.startTime) / 1000).toFixed(2);
  let str = "<p>Finish!!</p>"
    + "<p>レベル： " + config.level + "</p>"
    + "<p>タイム： " + score_time + "</p>"
    + "<p>間違えた回数： " + miss +"回</p>"
    +"<div class='btn_box'><div class='btn js_retry'>もう一回</div>"
    +"<div class='btn js_quit'>終了</div></div>";
  // 履歴を保存
  history.push((history.length+1)+'. '+'level'+config.level+" <b style='font-size:1.5rem;'> " + score_time + " </b> (miss " + miss + ")");
  if(history.length>1){
    str = str+'<hr>'+history.join('<br>');
  }
  $('#howto').html(str);
  timer.stopTimer();
  $('#message').css('display', 'block');
}

            // // --------------------------------------------
            // // 音声認識
            // // --------------------------------------------
            // let word;
            // let rec = new webkitSpeechRecognition();
            // rec.rang = 'ja-JP';
            // // start
            // rec.start();
            // // result
            // rec.onresult = (e) => {
            //     console.log(e);
            //     if (e.results[0].isFinal == true) {
            //         // 音声認識
            //         word = e.results[0][0].transcript;
            //         if (word == 'スタート') {
            //             // 設問セット
            //             console.log('start');
            //             generateNumber();
            //         } else if (word == answer) {
            //             // 正解！！
            //             openNotice('<span class="correct">'+word + '<br>Correct!!!!!</span>');
            //             sleep(3);
            //             flg = false;
            //             generateNumber();
            //         }
            //     }
            // };
            // //---------------------------
            // // 続けて音声認識
            // rec.onend = () => {
            //     console.log('restart');
            //     rec.start();
            // };
})
</script>
</body>
</html> 